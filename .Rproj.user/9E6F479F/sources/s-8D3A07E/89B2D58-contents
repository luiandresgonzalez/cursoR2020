# Analysis script (written in R Studio) for 'The scent of enrichment: Exploring the effect of odour and biological salience on behaviour during enrichment of kennelled dogs'
# Ben Brilot April 2019
# Revisions: 

#Required packages
library(lme4)
library(MASS)
library(ggplot2)
library(psych)
library(dplyr)

#Load in data. Labelled as 'Masterfile'
dat <- read.csv(file.choose("") , header=TRUE)

#Subset data frame for analysis of behaviour states/events (where interaction with different scent types is not split out)
dat.s<-subset(dat,Period=="Unscented toys")

#Setting up Helmert contrasts for analysis
ControlvsScent<-c(2,-1,-1)
LavendervsRabbit<-c(0,1,-1)
contrasts(dat$Scent)<-cbind(ControlvsScent,LavendervsRabbit)
dat$Scent

BasevsToys<-c(2,-1,-1)
NoscentvsScent<-c(0,1,-1)
dat.s$Period3<-dat.s$Period2
contrasts(dat.s$Period3)<-cbind(BasevsToys,NoscentvsScent)
dat.s$Period3


#Analysis part 1: likelihood of toy interaction --------------------------------------

#crosstabs of likelihood of interacting or not, by period and scent
mytable <- xtabs(~dat$Period+dat$Scent+dat$Interact1zero, data=dat)
ftable(mytable) # print table 


#Effect of scent present/absent on likelihood of interacting with toys. Built model with/without factor and compared using likelihood ratio test
mdlfull<-glmer(Interact1zero~Period+Scent+Scent*Period+(1|Subject),data=dat,family=binomial)
summary(mdlfull)
anova(mdlfull)

mdlnullperiod <- glmer(Interact1zero~Scent+(1|Subject), data=dat, family = binomial)
summary(mdlnullperiod)
anova(mdlnullperiod)

#Likelihood ratio test
anova(mdlfull,mdlnullperiod)


#effect of scent identity on likelihood of interaction
mdlnullscent <- glmer(Interact1zero~Period+(1|Subject), data=dat, family = binomial)
summary(mdlnullscent)
anova(mdlnullscent)

#Likelihood ratio test
anova(mdlfull,mdlnullscent)


#effect of period*scent identity on likelihood of interaction
mdlnullinteract <- glmer(Interact1zero~Period+Scent+(1|Subject), data=dat, family = binomial)
summary(mdlnullinteract)
anova(mdlnullinteract)

#Likelihood ratio test
anova(mdlfull,mdlnullinteract)



#Analysis part 2: duration of toy interaction --------------------------------------

#check of effect of scent present/absent and scent ID on DURATION of interacting with toys. Built model with/without factor and compared using likelihood ratio test

#Log transform duration variable, Shapiro-Wilks shows not normally distributed, but residuals from model are ok.
hist(dat$Interactduration)
dat$loginteract<-log10(dat$Interactduration+2)
hist(dat$loginteract)
shapiro.test(dat$loginteract)

#Effect of scent present/absent on likelihood of interacting with toys.
#Also gives the results of the planned contrasts analysis
mdlfull<-lmer(loginteract~Period+Scent+Scent*Period+(1|Subject),data=dat,REML=FALSE)
summary(mdlfull)
anova(mdlfull)

mdlnullperiod <- lmer(loginteract~Scent+(1|Subject), data=dat,REML=FALSE)
summary(mdlnullperiod)
anova(mdlnullperiod)

mdlnullscent <- lmer(loginteract~Period+(1|Subject), data=dat,REML=FALSE)
summary(mdlnullscent)
anova(mdlnullscent)

mdlnullinteract <-lmer(loginteract~Scent+Period+(1|Subject),data=dat,REML=FALSE)
summary(mdlnullinteract)
anova(mdlnullinteract)

#Likelihood ratio tests
anova(mdlfull,mdlnullperiod)
anova(mdlfull,mdlnullscent)
anova(mdlfull,mdlnullinteract)

#check residuals
hist(resid(mdlfull), main = "Residual distribution", xlab = "Residuals" )
qqnorm(resid(mdlfull),main = "Residual distribution", xlab = "Residuals")
qqline(resid(mdlfull))
shapiro.test(resid(mdlfull))


#Analysis part 3: stress behaviours --------------------------------------
hist(dat.s$Stress)
dat.s$logStress<-log10(dat.s$Stress+2)
hist(dat.s$logStress)
shapiro.test(dat.s$logStress)

mdlfull<-lmer(logStress~Period3+(1|Subject2),data=dat.s,REML=FALSE)
summary(mdlfull)
anova(mdlfull)

mdlnullperiod<-lmer(logStress~(1|Subject2),data=dat.s,REML=FALSE)
summary(mdlnullperiod)
anova(mdlnullperiod)

#Likelihood ratio test
anova(mdlfull, mdlnullperiod)

#check residuals
hist(resid(mdlfull), main = "Residual distribution", xlab = "Residuals" )
qqnorm(resid(mdlfull),main = "Residual distribution", xlab = "Residuals")
qqline(resid(mdlfull))
shapiro.test(resid(mdlfull))



#Analysis part 4: ARB behaviours --------------------------------------\
hist(dat.s$Repetitive)
dat.s$logRepetitive<-log10(dat.s$Repetitive+2)
hist(dat.s$logRepetitive)
shapiro.test(dat.s$logRepetitive)
# Data are intractable to parametric methods, so Hurdle method used

#crosstabs of likelihood of interacting or not, by period and scent
mytable <- xtabs(~dat.s$Period3+dat.s$ARB1zero, data=dat.s)
ftable(mytable) # print table 

#Check first for binomial ARBs expressed or not across three periods. Set to zero/one binary categories for if behaviour expressed
dat.s$ARB1zero<-dat.s$Repetitive
dat.s$ARB1zero[dat.s$ARB1zero>0]<-1

mdlfull<-glmer(ARB1zero~Period3+(1|Subject2),data=dat.s,family=binomial)
summary(mdlfull)
anova(mdlfull)

mdlnullperiod <- glmer(ARB1zero~(1|Subject2), data=dat.s, family = binomial)
summary(mdlnullperiod)
anova(mdlnullperiod)

anova(mdlfull,mdlnullperiod)



#Excluding zeroes from ARB durations for second part of Hurdle analysis (duration of ARBs)
dat.s$ARBduration<-dat.s$Repetitive
dat.s$ARBduration[dat.s$ARB1zero==0]<-NA

hist(dat.s$ARBduration)
dat.s$sqrtARBduration<-sqrt(dat.s$ARBduration+2)
hist(dat.s$sqrtARBduration)
shapiro.test(dat.s$sqrtARBduration)

mdlfull<-lmer(sqrtARBduration~Period3+(1|Subject2),data=dat.s,REML=FALSE)
summary(mdlfull)
anova(mdlfull)

mdlnullperiod<-lmer(sqrtARBduration~(1|Subject2),data=dat.s,REML=FALSE)
summary(mdlnullperiod)
anova(mdlnullperiod)

anova(mdlfull, mdlnullperiod)

#check residuals
hist(resid(mdlfull), main = "Residual distribution", xlab = "Residuals" )
qqnorm(resid(mdlfull),main = "Residual distribution", xlab = "Residuals")
qqline(resid(mdlfull))
shapiro.test(resid(mdlfull))



#Analysis part 5: vocalisations --------------------------------------
hist(dat.s$Vocal)
dat.s$sqrtVocal<-sqrt(dat.s$Vocal+2)
hist(dat.s$sqrtVocal)
shapiro.test(dat.s$sqrtVocal)

mdlfull<-lmer(sqrtVocal~Period2+(1|Subject2),data=dat.s,REML=FALSE)
summary(mdlfull)
anova(mdlfull)

mdlnullperiod<-lmer(sqrtVocal~(1|Subject2),data=dat.s,REML=FALSE)
summary(mdlnullperiod)
anova(mdlnullperiod)

anova(mdlfull, mdlnullperiod)

#check residuals
hist(resid(mdlfull), main = "Residual distribution", xlab = "Residuals" )
qqnorm(resid(mdlfull),main = "Residual distribution", xlab = "Residuals")
qqline(resid(mdlfull))
shapiro.test(resid(mdlfull))



#Analysis part 6: Exploration behaviour --------------------------------------
hist(dat.s$Explore)
dat.s$logExplore<-log10(dat.s$Explore+2)
hist(dat.s$logExplore)
shapiro.test(dat.s$logExplore)
#Hurdle approach more appropriate given data constraints

#Check first for binomial exploration expressed or not across three periods. Alter to binary zero/one outcome
dat.s$Expl1zero<-dat.s$Explore
dat.s$Expl1zero[dat.s$Expl1zero>0]<-1
dat.s$Expl1zero

mdlfull<-glmer(Expl1zero~Period3+(1|Subject2),data=dat.s,family=binomial)
summary(mdlfull)
anova(mdlfull)

mdlnullperiod <- glmer(Expl1zero~(1|Subject2), data=dat.s, family = binomial)
summary(mdlnullperiod)
anova(mdlnullperiod)

anova(mdlfull,mdlnullperiod)

#crosstabs of likelihood of interacting or not, by period and scent
mytable <- xtabs(~dat.s$Period3+dat.s$Expl1zero, data=dat.s)
ftable(mytable) # print table 


#Excluding zeroes from exploration durations. Second part of Hurdle analysis
dat.s$Expldur<-dat.s$Explore
dat.s$Expldur[dat.s$Expldur==0]<-NA
dat.s$Expldur

dat.s$sqrtExpldur<-sqrt(dat.s$Expldur+2)
hist(dat.s$sqrtExpldur)
shapiro.test(dat.s$sqrtExpldur)

mdlfull<-lmer(sqrtExpldur~Period3+(1|Subject2),data=dat.s)
summary(mdlfull)
anova(mdlfull)

mdlnullperiod<-lmer(sqrtExpldur~(1|Subject2),data=dat.s)
summary(mdlnullperiod)
anova(mdlnullperiod)

anova(mdlfull, mdlnullperiod)

#check residuals
hist(resid(mdlfull), main = "Residual distribution", xlab = "Residuals" )
qqnorm(resid(mdlfull),main = "Residual distribution", xlab = "Residuals")
qqline(resid(mdlfull))
shapiro.test(resid(mdlfull))



#Analysis part 7: Resting behaviour --------------------------------------
str(dat.s)
hist(dat.s$Rest)
dat.s$logRest<-log10(dat.s$Rest+2)
hist(dat.s$logRest)
shapiro.test(dat.s$logRest)
#Hurdle approach more appropriate given data constraints

#Check first for binomial resting expressed or not across three periods. Alter to binary zero/one outcome
dat.s$Rest1zero<-dat.s$Rest
dat.s$Rest1zero[dat.s$Rest1zero>0]<-1
dat.s$Rest1zero

mdlfull<-glmer(Rest1zero~Period3+(1|Subject2),data=dat.s,family=binomial)
summary(mdlfull)
anova(mdlfull)

mdlnullperiod <- glmer(Rest1zero~(1|Subject2), data=dat.s, family = binomial)
summary(mdlnullperiod)
anova(mdlnullperiod)

anova(mdlfull,mdlnullperiod)

#crosstabs of likelihood of resting or not, by period and scent
mytable <- xtabs(~dat.s$Period3+dat.s$Rest1zero, data=dat.s)
ftable(mytable) # print table 


#Excluding zeroes from rest durations. Second part of Hurdle analysis
dat.s$Restdur<-dat.s$Rest
dat.s$Restdur[dat.s$Restdur==0]<-NA
dat.s$Restdur

dat.s$sqrtRestdur<-sqrt(dat.s$Restdur+2)
hist(dat.s$sqrtRestdur)
shapiro.test(dat.s$sqrtRestdur)

mdlfull<-lmer(sqrtRestdur~Period3+(1|Subject2),data=dat.s)
summary(mdlfull)
anova(mdlfull)

mdlnullperiod<-lmer(sqrtRestdur~(1|Subject2),data=dat.s)
summary(mdlnullperiod)
anova(mdlnullperiod)

anova(mdlfull, mdlnullperiod)

#check residuals
hist(resid(mdlfull), main = "Residual distribution", xlab = "Residuals" )
qqnorm(resid(mdlfull),main = "Residual distribution", xlab = "Residuals")
qqline(resid(mdlfull))
shapiro.test(resid(mdlfull))



#Analysis part 8: Sleeping behaviour --------------------------------------
hist(dat.s$Sleep)
dat.s$sqrtSleep<-sqrt(dat.s$Sleep+2)
hist(dat.s$sqrtSleep)
shapiro.test(dat.s$sqrtSleep)

#Check first for binomial sleeping expressed or not across three periods
dat.s$Sleep1zero<-dat.s$Sleep
dat.s$Sleep1zero
dat.s$Sleep1zero[dat.s$Sleep1zero>0]<-1
dat.s$Sleep1zero

mdlfull<-glmer(Sleep1zero~Period3+(1|Subject2),data=dat.s,family=binomial)
summary(mdlfull)
anova(mdlfull)

mdlnullperiod <- glmer(Sleep1zero~(1|Subject2), data=dat.s, family = binomial)
summary(mdlnullperiod)
anova(mdlnullperiod)

anova(mdlfull,mdlnullperiod)

#crosstabs of likelihood of sleeping or not, by period and scent
mytable <- xtabs(~dat.s$Period3+dat.s$Sleep1zero, data=dat.s)
ftable(mytable) # print table 


#Excluding zeroes from sleeping durations
dat.s$Sleepdur<-dat.s$Sleep
dat.s$Sleepdur[dat.s$Sleepdur==0]<-NA
dat.s$Sleepdur

hist(dat.s$Sleepdur)
dat.s$sqrtSleepdur<-sqrt(dat.s$Sleepdur+2)
hist(dat.s$sqrtSleepdur)
shapiro.test(dat.s$sqrtSleepdur)

mdlfull<-lmer(sqrtSleepdur~Period3+(1|Subject2),data=dat.s)
summary(mdlfull)
anova(mdlfull)

mdlnullperiod<-lmer(sqrtSleepdur~(1|Subject2),data=dat.s)
summary(mdlnullperiod)
anova(mdlnullperiod)

anova(mdlfull, mdlnullperiod)

#check residuals
hist(resid(mdlfull), main = "Residual distribution", xlab = "Residuals" )
qqnorm(resid(mdlfull),main = "Residual distribution", xlab = "Residuals")
qqline(resid(mdlfull))
shapiro.test(resid(mdlfull))




#Correlation analysis --------------------------------------
#Correlation analysis shows no relationship between behaviours, other than positive between sleep/rest and alert/explore. No
#relationship for any between total interaction time with toys and other behaviours.

head(dat.s)
str(dat.s)

#Setting up separate analyses for period with Unscented toys or Scented toys
dat.cornoscent<-filter(dat.s,dat.s$Period2=="Unscented toys")
dat.cornoscent<-dplyr::select(dat.cornoscent,Rest:Stress,Interacttotal)
str(dat.cornoscent)
dat.corscent<-filter(dat.s,dat.s$Period2=="Scented toys")
dat.corscent<-dplyr::select(dat.corscent,Rest:Stress,Interacttotal)
str(dat.corscent)
names(dat.corscent)

#This code calculates the correlation coefficient
corrmatrix1<-cor(dat.corscent, use="pairwise.complete.obs", method = c("kendall"))
round(corrmatrix1,2)
corrmatrix2<-cor(dat.cornoscent, use="pairwise.complete.obs", method = c("kendall"))
round(corrmatrix2,2)
cor.test(dat.corscent$Interacttotal,dat.corscent$Sleep,method="kendall")

#Double-check of those coefficients using another function, but this also calculates p-values
corr.test(dat.corscent,method="kendall")
corr.test(dat.cornoscent,method="kendall")

#Toy interaction as a predictor of behaviour. Analysis --------------------------------------
#This code is an analysis checking whether interaction with toys or not (as a binary predictor variable) can explain behaviours expressed
dat.s$Interact1zero<-as.factor(dat.s$Interact1zero)
str(dat.s)
str(dat.s$Period2)
dat.inte<-filter(dat.s, dat.s$Period2!="No toys")
str(dat.inte)


#Vocalisations
mdlfull<-lmer(sqrtVocal~Period2+Interact1zero+(1|Subject2),data=dat.inte,REML=FALSE)
summary(mdlfull)
anova(mdlfull)

mdlnullinteract<-lmer(sqrtVocal~Period2+(1|Subject2),data=dat.inte,REML=FALSE)
summary(mdlnullinteract)
anova(mdlnullinteract)

anova(mdlfull, mdlnullinteract)

hist(resid(mdlfull), main = "Residual distribution", xlab = "Residuals" )
qqnorm(resid(mdlfull),main = "Residual distribution", xlab = "Residuals")
qqline(resid(mdlfull))
shapiro.test(resid(mdlfull))


#Stress behaviours
dat.inte$Period3
mdlfull<-lmer(logStress~Period3+Interact1zero+(1|Subject2),data=dat.inte,REML=FALSE)
summary(mdlfull)
anova(mdlfull)

mdlnullinteract<-lmer(logStress~Period3+(1|Subject2),data=dat.inte,REML=FALSE)
summary(mdlnullinteract)
anova(mdlnullinteract)

anova(mdlfull, mdlnullinteract)

hist(resid(mdlfull), main = "Residual distribution", xlab = "Residuals" )
qqnorm(resid(mdlfull),main = "Residual distribution", xlab = "Residuals")
qqline(resid(mdlfull))
shapiro.test(resid(mdlfull))

#Likelihood of showing ARBs
mdlfull<-glmer(ARB1zero~Period3+Interact1zero+(1|Subject2),data=dat.inte,family=binomial)
summary(mdlfull)
anova(mdlfull)

mdlnullinteract <- glmer(ARB1zero~Period3+(1|Subject2), data=dat.inte, family = binomial)
summary(mdlnullinteract)
anova(mdlnullinteract)

anova(mdlfull,mdlnullinteract)


#Duration of ARBs
mdlfull<-lmer(sqrtARBduration~Period3+Interact1zero+(1|Subject2),data=dat.inte,REML=FALSE)
summary(mdlfull)
anova(mdlfull)

mdlnullinteract<-lmer(sqrtARBduration~Period3+(1|Subject2),data=dat.inte,REML=FALSE)
summary(mdlnullinteract)
anova(mdlnullinteract)

anova(mdlfull, mdlnullinteract)

hist(resid(mdlfull), main = "Residual distribution", xlab = "Residuals" )
qqnorm(resid(mdlfull),main = "Residual distribution", xlab = "Residuals")
qqline(resid(mdlfull))
shapiro.test(resid(mdlfull))


#Likelihood of exploring behaviour
mdlfull<-glmer(Expl1zero~Period3+Interact1zero+(1|Subject2),data=dat.inte,family=binomial)
summary(mdlfull)
anova(mdlfull)

mdlnullinteract <- glmer(Expl1zero~Period3+(1|Subject2), data=dat.inte, family = binomial)
summary(mdlnullinteract)
anova(mdlnullinteract)

anova(mdlfull,mdlnullinteract)

#Duration of exploration behaviour
mdlfull<-lmer(sqrtExpldur~Period3+Interact1zero+(1|Subject2),data=dat.inte)
summary(mdlfull)
anova(mdlfull)

mdlnullinteract<-lmer(sqrtExpldur~Period3+(1|Subject2),data=dat.inte)
summary(mdlnullinteract)
anova(mdlnullinteract)

anova(mdlfull, mdlnullinteract)

hist(resid(mdlfull), main = "Residual distribution", xlab = "Residuals" )
qqnorm(resid(mdlfull),main = "Residual distribution", xlab = "Residuals")
qqline(resid(mdlfull))
shapiro.test(resid(mdlfull))


#Sleeping behaviour
mdlfull<-glmer(Sleep1zero~Period3+Interact1zero+(1|Subject2),data=dat.inte,family=binomial)
summary(mdlfull)
anova(mdlfull)


mdlnullinteract <- glmer(Sleep1zero~Period3+(1|Subject2), data=dat.inte, family = binomial)
summary(mdlnullinteract)
anova(mdlnullinteract)

anova(mdlfull,mdlnullinteract)

mdlfull<-lmer(sqrtSleepdur~Period3+Interact1zero+(1|Subject2),data=dat.inte)
summary(mdlfull)
anova(mdlfull)

mdlnullinteract<-lmer(sqrtSleepdur~Period3+(1|Subject2),data=dat.inte)
summary(mdlnullinteract)
anova(mdlnullinteract)

anova(mdlfull, mdlnullinteract)

hist(resid(mdlfull), main = "Residual distribution", xlab = "Residuals" )
qqnorm(resid(mdlfull),main = "Residual distribution", xlab = "Residuals")
qqline(resid(mdlfull))
shapiro.test(resid(mdlfull))



#Figures--------------------------------------

dat$Period <- factor(dat$Period, c("Unscented toys", "Scented toys"))#Reorder categories for plotting
str(dat$Period)

dat.s$Period3 <- factor(dat.s$Period2, c("No toys", "Unscented toys", "Scented toys"))#Reorder categories for plotting
str(dat.s$Period3)


#Figure 1
ggplot(data = dat) + aes(x = Period, y = Interactduration, fill = Scent) +
  geom_boxplot(outlier.size = -1) + scale_fill_brewer(palette = "Greys") + geom_jitter(alpha=0.5,
                                                                     position=position_jitterdodge(jitter.width=0.2),
                                                                     aes(group= Scent))+
  labs(y = "Duration of interaction with toy (s)") + theme_minimal()

#Figure 2
ggplot(data = dat.s) +  aes(x = Period3, y = Stress) +
  geom_boxplot(fill = "Grey", outlier.size = -1) + geom_jitter(alpha=0.5,
                                                               position=position_jitter(0.2)) +
  labs(y = "Total frequency of stress behaviours", x = "Period") + theme_minimal()

#Figure 3
ggplot(data = dat.s) +  aes(x = Period3, y = ARBduration) +
  geom_boxplot(fill = "Grey", outlier.size = -1) + geom_jitter(alpha=0.5,
                                                               position=position_jitter(0.2)) +
  labs(y = "Duration of abnormal repetitive behaviours (s)", x="Period") + theme_minimal()

#Figure 4
ggplot(data = dat.s) +  aes(x = Period3, y = Explore) +
  geom_boxplot(fill = "Grey", outlier.size = -1) + geom_jitter(alpha=0.5,
                                            position=position_jitter(0.2)) +
  labs(y = "Duration of exploration behaviour (s)", x = "Period") + theme_minimal()










#Post-review revision, check for negative/positive contrast effects--------------------------------------


#Effect of scent present/absent on likelihood of interacting with toys. Built model with/without factor and compared using likelihood ratio test
mdlfull<-glmer(Interact1zero~Period+Scent+Scent*Period+PosNeg+(1|Subject),data=dat,family=binomial)
summary(mdlfull)
anova(mdlfull)

mdlnullcontrast <- glmer(Interact1zero~Period+Scent+Scent*Period+(1|Subject), data=dat, family = binomial)
summary(mdlnullcontrast)
anova(mdlnullcontrast)

#Likelihood ratio test
anova(mdlfull,mdlnullcontrast)



#check of effect of scent present/absent and scent ID on DURATION of interacting with toys. Built model with/without factor and compared using likelihood ratio test
mdlfull<-lmer(loginteract~Period+Scent+Scent*Period+PosNeg+(1|Subject),data=dat,REML=FALSE)
summary(mdlfull)
anova(mdlfull)

mdlnullcontrast <- lmer(loginteract~Period+Scent+Scent*Period+(1|Subject), data=dat,REML=FALSE)
summary(mdlnullcontrast)
anova(mdlnullcontrast)

#Likelihood ratio test
anova(mdlfull,mdlnullcontrast)




#Stress behaviours 
mdlfull<-lmer(logStress~Period3+PosNeg+(1|Subject2),data=dat.s,REML=FALSE)
summary(mdlfull)
anova(mdlfull)

mdlnullcontrast<-lmer(logStress~Period3+(1|Subject2),data=dat.s,REML=FALSE)
summary(mdlnullcontrast)
anova(mdlnullcontrast)

#Likelihood ratio test
anova(mdlfull, mdlnullcontrast)



#ARB behaviours --------------------------------------
mdlfull<-glmer(ARB1zero~Period3+PosNeg+(1|Subject2),data=dat.s,family=binomial)
summary(mdlfull)
anova(mdlfull)

mdlnullcontrast <- glmer(ARB1zero~Period3+(1|Subject2), data=dat.s, family = binomial)
summary(mdlnullcontrast)
anova(mdlnullcontrast)

anova(mdlfull,mdlnullcontrast)

#Excluding zeroes from ARB durations for second part of Hurdle analysis (duration of ARBs)
dat.s$ARBduration<-dat.s$Repetitive
dat.s$ARBduration[dat.s$ARB1zero==0]<-NA

mdlfull<-lmer(sqrtARBduration~Period3+PosNeg+(1|Subject2),data=dat.s,REML=FALSE)
summary(mdlfull)
anova(mdlfull)

mdlnullcontrast<-lmer(sqrtARBduration~Period3+(1|Subject2),data=dat.s,REML=FALSE)
summary(mdlnullcontrast)
anova(mdlnullcontrast)

anova(mdlfull, mdlnullcontrast)



#Exploration behaviour --------------------------------------
hist(dat.s$Explore)
dat.s$logExplore<-log10(dat.s$Explore+2)
hist(dat.s$logExplore)
shapiro.test(dat.s$logExplore)
#Hurdle approach more appropriate given data constraints

#Check first for binomial exploration expressed or not across three periods. Alter to binary zero/one outcome
dat.s$Expl1zero<-dat.s$Explore
dat.s$Expl1zero[dat.s$Expl1zero>0]<-1
dat.s$Expl1zero

mdlfull<-glmer(Expl1zero~Period3+PosNeg+(1|Subject2),data=dat.s,family=binomial)
summary(mdlfull)
anova(mdlfull)

mdlnullcontrast <- glmer(Expl1zero~Period3+(1|Subject2), data=dat.s, family = binomial)
summary(mdlnullcontrast)
anova(mdlnullcontrast)

anova(mdlfull,mdlnullcontrast)

#Excluding zeroes from exploration durations. Second part of Hurdle analysis
dat.s$Expldur<-dat.s$Explore
dat.s$Expldur[dat.s$Expldur==0]<-NA
dat.s$Expldur

dat.s$sqrtExpldur<-sqrt(dat.s$Expldur+2)
hist(dat.s$sqrtExpldur)
shapiro.test(dat.s$sqrtExpldur)

mdlfull<-lmer(sqrtExpldur~Period3+PosNeg+(1|Subject2),data=dat.s)
summary(mdlfull)
anova(mdlfull)

mdlnullcontrast<-lmer(sqrtExpldur~Period3+(1|Subject2),data=dat.s)
summary(mdlnullcontrast)
anova(mdlnullcontrast)

anova(mdlfull, mdlnullcontrast)



#Resting behaviour --------------------------------------
#Check first for binomial resting expressed or not across three periods. Alter to binary zero/one outcome
dat.s$Rest1zero<-dat.s$Rest
dat.s$Rest1zero[dat.s$Rest1zero>0]<-1
dat.s$Rest1zero

mdlfull<-glmer(Rest1zero~Period3+PosNeg+(1|Subject2),data=dat.s,family=binomial)
summary(mdlfull)
anova(mdlfull)

mdlnullcontrast <- glmer(Rest1zero~Period3+(1|Subject2), data=dat.s, family = binomial)
summary(mdlnullcontrast)
anova(mdlnullcontrast)

anova(mdlfull,mdlnullcontrast)

#Excluding zeroes from rest durations. Second part of Hurdle analysis
dat.s$Restdur<-dat.s$Rest
dat.s$Restdur[dat.s$Restdur==0]<-NA
dat.s$Restdur

dat.s$sqrtRestdur<-sqrt(dat.s$Restdur+2)
hist(dat.s$sqrtRestdur)
shapiro.test(dat.s$sqrtRestdur)

mdlfull<-lmer(sqrtRestdur~Period3+PosNeg+(1|Subject2),data=dat.s)
summary(mdlfull)
anova(mdlfull)

mdlnullcontrast<-lmer(sqrtRestdur~Period3+(1|Subject2),data=dat.s)
summary(mdlnullcontrast)
anova(mdlnullcontrast)

anova(mdlfull, mdlnullcontrast)


#Sleeping behaviour --------------------------------------
#Check first for binomial sleeping expressed or not across three periods
dat.s$Sleep1zero<-dat.s$Sleep
dat.s$Sleep1zero
dat.s$Sleep1zero[dat.s$Sleep1zero>0]<-1
dat.s$Sleep1zero

mdlfull<-glmer(Sleep1zero~Period3+PosNeg+(1|Subject2),data=dat.s,family=binomial)
summary(mdlfull)
anova(mdlfull)

mdlnullcontrast <- glmer(Sleep1zero~Period3+(1|Subject2), data=dat.s, family = binomial)
summary(mdlnullcontrast)
anova(mdlnullcontrast)

anova(mdlfull,mdlnullcontrast)

#Excluding zeroes from sleeping durations
dat.s$Sleepdur<-dat.s$Sleep
dat.s$Sleepdur[dat.s$Sleepdur==0]<-NA
dat.s$Sleepdur

mdlfull<-lmer(sqrtSleepdur~Period3+PosNeg+(1|Subject2),data=dat.s)
summary(mdlfull)
anova(mdlfull)

mdlnullcontrast<-lmer(sqrtSleepdur~Period3+(1|Subject2),data=dat.s)
summary(mdlnullcontrast)
anova(mdlnullcontrast)

anova(mdlfull, mdlnullcontrast)



#Figure 1 CHECK for constrast effect
figure1=ggplot(data = dat) + aes(x = Period, y = Interactduration, fill = Scent) +
  geom_boxplot(outlier.size = -1) + scale_fill_brewer(palette = "Greys") + geom_jitter(alpha=0.5,
                                                                                       position=position_jitterdodge(jitter.width=0.2),
                                                                                       aes(group= Scent))+
  labs(y = "Duration of interaction with toy (s)") + theme_minimal()

figure1+facet_grid(.~dat$PosNeg)

#Figure 2 CHECK for contrast effect
figure2=ggplot(data = dat.s) +  aes(x = Period3, y = Stress) +
  geom_boxplot(fill = "Grey", outlier.size = -1) + geom_jitter(alpha=0.5,
                                                               position=position_jitter(0.2)) +
  labs(y = "Total frequency of stress behaviours", x = "Period") + theme_minimal()

figure2+facet_grid(.~dat.s$PosNeg)

#Figure 3 CHECK for contrast effect
figure3=ggplot(data = dat.s) +  aes(x = Period3, y = ARBduration) +
  geom_boxplot(fill = "Grey", outlier.size = -1) + geom_jitter(alpha=0.5,
                                                               position=position_jitter(0.2)) +
  labs(y = "Duration of abnormal repetitive behaviours (s)", x="Period") + theme_minimal()

figure3+facet_grid(.~dat.s$PosNeg)


#Figure 4 CHECK for contrast effect
figure4=ggplot(data = dat.s) +  aes(x = Period3, y = Explore) +
  geom_boxplot(fill = "Grey", outlier.size = -1) + geom_jitter(alpha=0.5,
                                                               position=position_jitter(0.2)) +
  labs(y = "Duration of exploration behaviour (s)", x = "Period") + theme_minimal()

figure4+facet_grid(.~dat.s$PosNeg)



#Analysis to check whether positive-negative contrast effect alters statistical conclusions

#Part 1: likelihood of toy interaction --------------------------------------


#Effect of scent present/absent on likelihood of interacting with toys. Built model with/without factor and compared using likelihood ratio test
mdlfull<-glmer(Interact1zero~Period+Scent+Scent*Period+PosNeg+(1|Subject),data=dat,family=binomial)
summary(mdlfull)
anova(mdlfull)

mdlnullperiod <- glmer(Interact1zero~Scent+PosNeg+(1|Subject), data=dat, family = binomial)
summary(mdlnullperiod)
anova(mdlnullperiod)

#Likelihood ratio test
anova(mdlfull,mdlnullperiod)


#effect of scent identity on likelihood of interaction
mdlnullscent <- glmer(Interact1zero~Period+PosNeg+(1|Subject), data=dat, family = binomial)
summary(mdlnullscent)
anova(mdlnullscent)

#Likelihood ratio test
anova(mdlfull,mdlnullscent)


#effect of period*scent identity on likelihood of interaction
mdlnullinteract <- glmer(Interact1zero~Period+Scent+PosNeg+(1|Subject), data=dat, family = binomial)
summary(mdlnullinteract)
anova(mdlnullinteract)

#Likelihood ratio test
anova(mdlfull,mdlnullinteract)



#Analysis part 2: duration of toy interaction --------------------------------------

#check of effect of scent present/absent and scent ID on DURATION of interacting with toys. Built model with/without factor and compared using likelihood ratio test

#Log transform duration variable, Shapiro-Wilks shows not normally distributed, but residuals from model are ok.
hist(dat$Interactduration)
dat$loginteract<-log10(dat$Interactduration+2)
hist(dat$loginteract)
shapiro.test(dat$loginteract)

#Effect of scent present/absent on likelihood of interacting with toys.
#Also gives the results of the planned contrasts analysis
mdlfull<-lmer(loginteract~Period+Scent+Scent*Period+PosNeg+(1|Subject),data=dat,REML=FALSE)
summary(mdlfull)
anova(mdlfull)

mdlnullperiod <- lmer(loginteract~Scent+PosNeg+(1|Subject), data=dat,REML=FALSE)
summary(mdlnullperiod)
anova(mdlnullperiod)

mdlnullscent <- lmer(loginteract~Period+PosNeg+(1|Subject), data=dat,REML=FALSE)
summary(mdlnullscent)
anova(mdlnullscent)

mdlnullinteract <-lmer(loginteract~Scent+Period+PosNeg+(1|Subject),data=dat,REML=FALSE)
summary(mdlnullinteract)
anova(mdlnullinteract)

#Likelihood ratio tests
anova(mdlfull,mdlnullperiod)
anova(mdlfull,mdlnullscent)
anova(mdlfull,mdlnullinteract)



#Analysis part 3: stress behaviours --------------------------------------
hist(dat.s$Stress)
dat.s$logStress<-log10(dat.s$Stress+2)
hist(dat.s$logStress)
shapiro.test(dat.s$logStress)

mdlfull<-lmer(logStress~Period3+PosNeg+(1|Subject2),data=dat.s,REML=FALSE)
summary(mdlfull)
anova(mdlfull)

mdlnullperiod<-lmer(logStress~PosNeg+(1|Subject2),data=dat.s,REML=FALSE)
summary(mdlnullperiod)
anova(mdlnullperiod)

#Likelihood ratio test
anova(mdlfull, mdlnullperiod)


#Analysis part 4: ARB behaviours --------------------------------------\
hist(dat.s$Repetitive)
dat.s$logRepetitive<-log10(dat.s$Repetitive+2)
hist(dat.s$logRepetitive)
shapiro.test(dat.s$logRepetitive)
# Data are intractable to parametric methods, so Hurdle method used


#Check first for binomial ARBs expressed or not across three periods. Set to zero/one binary categories for if behaviour expressed
dat.s$ARB1zero<-dat.s$Repetitive
dat.s$ARB1zero[dat.s$ARB1zero>0]<-1

mdlfull<-glmer(ARB1zero~Period3+PosNeg+(1|Subject2),data=dat.s,family=binomial)
summary(mdlfull)
anova(mdlfull)

mdlnullperiod <- glmer(ARB1zero~PosNeg+(1|Subject2), data=dat.s, family = binomial)
summary(mdlnullperiod)
anova(mdlnullperiod)

anova(mdlfull,mdlnullperiod)



#Excluding zeroes from ARB durations for second part of Hurdle analysis (duration of ARBs)
dat.s$ARBduration<-dat.s$Repetitive
dat.s$ARBduration[dat.s$ARB1zero==0]<-NA

hist(dat.s$ARBduration)
dat.s$sqrtARBduration<-sqrt(dat.s$ARBduration+2)
hist(dat.s$sqrtARBduration)
shapiro.test(dat.s$sqrtARBduration)

mdlfull<-lmer(sqrtARBduration~Period3+PosNeg+(1|Subject2),data=dat.s,REML=FALSE)
summary(mdlfull)
anova(mdlfull)

mdlnullperiod<-lmer(sqrtARBduration~PosNeg+(1|Subject2),data=dat.s,REML=FALSE)
summary(mdlnullperiod)
anova(mdlnullperiod)

anova(mdlfull, mdlnullperiod)



#Analysis part 5: vocalisations --------------------------------------
hist(dat.s$Vocal)
dat.s$sqrtVocal<-sqrt(dat.s$Vocal+2)
hist(dat.s$sqrtVocal)
shapiro.test(dat.s$sqrtVocal)

mdlfull<-lmer(sqrtVocal~Period2+PosNeg+(1|Subject2),data=dat.s,REML=FALSE)
summary(mdlfull)
anova(mdlfull)

mdlnullperiod<-lmer(sqrtVocal~PosNeg+(1|Subject2),data=dat.s,REML=FALSE)
summary(mdlnullperiod)
anova(mdlnullperiod)

anova(mdlfull, mdlnullperiod)


#Analysis part 6: Exploration behaviour --------------------------------------
#Hurdle approach more appropriate given data constraints

#Check first for binomial exploration expressed or not across three periods. Alter to binary zero/one outcome
dat.s$Expl1zero<-dat.s$Explore
dat.s$Expl1zero[dat.s$Expl1zero>0]<-1
dat.s$Expl1zero

mdlfull<-glmer(Expl1zero~Period3+PosNeg+(1|Subject2),data=dat.s,family=binomial)
summary(mdlfull)
anova(mdlfull)

mdlnullperiod <- glmer(Expl1zero~PosNeg+(1|Subject2), data=dat.s, family = binomial)
summary(mdlnullperiod)
anova(mdlnullperiod)

anova(mdlfull,mdlnullperiod)


#Excluding zeroes from exploration durations. Second part of Hurdle analysis
dat.s$Expldur<-dat.s$Explore
dat.s$Expldur[dat.s$Expldur==0]<-NA
dat.s$Expldur

dat.s$sqrtExpldur<-sqrt(dat.s$Expldur+2)
hist(dat.s$sqrtExpldur)
shapiro.test(dat.s$sqrtExpldur)

mdlfull<-lmer(sqrtExpldur~Period3+PosNeg+(1|Subject2),data=dat.s)
summary(mdlfull)
anova(mdlfull)

mdlnullperiod<-lmer(sqrtExpldur~PosNeg+(1|Subject2),data=dat.s)
summary(mdlnullperiod)
anova(mdlnullperiod)

anova(mdlfull, mdlnullperiod)


#Analysis part 7: Resting behaviour --------------------------------------
#Hurdle approach more appropriate given data constraints

#Check first for binomial resting expressed or not across three periods. Alter to binary zero/one outcome
dat.s$Rest1zero<-dat.s$Rest
dat.s$Rest1zero[dat.s$Rest1zero>0]<-1
dat.s$Rest1zero

mdlfull<-glmer(Rest1zero~Period3+PosNeg+(1|Subject2),data=dat.s,family=binomial)
summary(mdlfull)
anova(mdlfull)

mdlnullperiod <- glmer(Rest1zero~PosNeg+(1|Subject2), data=dat.s, family = binomial)
summary(mdlnullperiod)
anova(mdlnullperiod)

anova(mdlfull,mdlnullperiod)


#Excluding zeroes from rest durations. Second part of Hurdle analysis
dat.s$Restdur<-dat.s$Rest
dat.s$Restdur[dat.s$Restdur==0]<-NA
dat.s$Restdur

dat.s$sqrtRestdur<-sqrt(dat.s$Restdur+2)
hist(dat.s$sqrtRestdur)
shapiro.test(dat.s$sqrtRestdur)

mdlfull<-lmer(sqrtRestdur~Period3+PosNeg+(1|Subject2),data=dat.s)
summary(mdlfull)
anova(mdlfull)

mdlnullperiod<-lmer(sqrtRestdur~PosNeg+(1|Subject2),data=dat.s)
summary(mdlnullperiod)
anova(mdlnullperiod)

anova(mdlfull, mdlnullperiod)



#Analysis part 8: Sleeping behaviour --------------------------------------
#Check first for binomial sleeping expressed or not across three periods
dat.s$Sleep1zero<-dat.s$Sleep
dat.s$Sleep1zero
dat.s$Sleep1zero[dat.s$Sleep1zero>0]<-1
dat.s$Sleep1zero

mdlfull<-glmer(Sleep1zero~Period3+PosNeg+(1|Subject2),data=dat.s,family=binomial)
summary(mdlfull)
anova(mdlfull)

mdlnullperiod <- glmer(Sleep1zero~PosNeg+(1|Subject2), data=dat.s, family = binomial)
summary(mdlnullperiod)
anova(mdlnullperiod)

anova(mdlfull,mdlnullperiod)


#Excluding zeroes from sleeping durations
dat.s$Sleepdur<-dat.s$Sleep
dat.s$Sleepdur[dat.s$Sleepdur==0]<-NA
dat.s$Sleepdur

hist(dat.s$Sleepdur)
dat.s$sqrtSleepdur<-sqrt(dat.s$Sleepdur+2)
hist(dat.s$sqrtSleepdur)
shapiro.test(dat.s$sqrtSleepdur)

mdlfull<-lmer(sqrtSleepdur~Period3+PosNeg+(1|Subject2),data=dat.s)
summary(mdlfull)
anova(mdlfull)

mdlnullperiod<-lmer(sqrtSleepdur~PosNeg+(1|Subject2),data=dat.s)
summary(mdlnullperiod)
anova(mdlnullperiod)

anova(mdlfull, mdlnullperiod)

